<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MovieServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">project</a> &gt; <a href="index.source.html" class="el_package">cse364.project</a> &gt; <span class="el_source">MovieServiceImpl.java</span></div><h1>MovieServiceImpl.java</h1><pre class="source lang-java linenums">package cse364.project;

import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

@Service
public class MovieServiceImpl implements MovieService {
    private final MovieRepository movieRepository;
    private final RatingRepository ratingRepository;
    private final UserRepository userRepository;

    public MovieServiceImpl(MovieRepository movieRepository, RatingRepository ratingRepository,
<span class="fc" id="L16">            UserRepository userRepository) {</span>
<span class="fc" id="L17">        this.movieRepository = movieRepository;</span>
<span class="fc" id="L18">        this.ratingRepository = ratingRepository;</span>
<span class="fc" id="L19">        this.userRepository = userRepository;</span>
<span class="fc" id="L20">    }</span>

    @Override
    public List&lt;Long&gt; getMovieStats(Long movieId) {
<span class="fc" id="L24">        Optional&lt;Movie&gt; movieOptional = movieRepository.findById(movieId);</span>
<span class="fc bfc" id="L25" title="All 2 branches covered.">        if (movieOptional.isEmpty()) {</span>
<span class="fc" id="L26">            throw new CannotFoundException(&quot;movie&quot;, movieId);</span>
        }

<span class="fc" id="L29">        List&lt;Rating&gt; ratings = ratingRepository.findByMovieId(movieId);</span>

<span class="fc" id="L31">        long sumOfRatings = 0;</span>
<span class="fc" id="L32">        long numOfRatings = ratings.size();</span>
<span class="fc" id="L33">        long numMaleOver3 = 0;</span>
<span class="fc" id="L34">        long numFemaleOver3 = 0;</span>
<span class="fc" id="L35">        long num1Over3 = 0;</span>
<span class="fc" id="L36">        long num25Over3 = 0;</span>
<span class="fc" id="L37">        long num35Over3 = 0;</span>
<span class="fc" id="L38">        long num50Over3 = 0;</span>

<span class="fc bfc" id="L40" title="All 2 branches covered.">        for (Rating rating : ratings) {</span>
<span class="fc" id="L41">            long ratingValue = rating.getRate();</span>
<span class="fc bfc" id="L42" title="All 2 branches covered.">            if (ratingValue &gt;= 3) {</span>
<span class="fc" id="L43">                sumOfRatings += ratingValue;</span>

<span class="fc" id="L45">                Long userId = rating.getUser_id();</span>
<span class="fc" id="L46">                Optional&lt;User&gt; userOptional = userRepository.findById(userId);</span>
<span class="fc bfc" id="L47" title="All 2 branches covered.">                if (userOptional.isPresent()) {</span>
<span class="fc" id="L48">                    User user = userOptional.get();</span>
<span class="fc" id="L49">                    String gender = user.getGender();</span>
<span class="fc" id="L50">                    int age = user.getAge();</span>

<span class="fc bfc" id="L52" title="All 2 branches covered.">                    if (gender != null) {</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">                        if (gender.equals(&quot;M&quot;)) {</span>
<span class="fc" id="L54">                            numMaleOver3++;</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">                        } else if (gender.equals(&quot;F&quot;)) {</span>
<span class="fc" id="L56">                            numFemaleOver3++;</span>
                        } else {
<span class="fc" id="L58">                            throw new InvalidUserException(&quot;gender&quot;, gender);</span>
                        }
                    } else {
<span class="fc" id="L61">                        throw new InvalidUserException(&quot;gender&quot;, gender);</span>
                    }

<span class="fc bfc" id="L64" title="All 2 branches covered.">                    if (age &gt;= 50) {</span>
<span class="fc" id="L65">                        num50Over3++;</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">                    } else if (age &gt;= 35) {</span>
<span class="fc" id="L67">                        num35Over3++;</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">                    } else if (age &gt;= 25) {</span>
<span class="fc" id="L69">                        num25Over3++;</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">                    } else if (age &gt;= 1) {</span>
<span class="fc" id="L71">                        num1Over3++;</span>
                    } else {
<span class="fc" id="L73">                        throw new InvalidUserException(&quot;age&quot;, String.valueOf(age));</span>
                    }
<span class="fc" id="L75">                } else {</span>
<span class="fc" id="L76">                    throw new InvalidUserException(&quot;userId&quot;, String.valueOf(userId));</span>
                }
            }
<span class="fc" id="L79">        }</span>

<span class="fc" id="L81">        List&lt;Long&gt; movieStats = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L82">        movieStats.add(numMaleOver3);</span>
<span class="fc" id="L83">        movieStats.add(numFemaleOver3);</span>
<span class="fc" id="L84">        movieStats.add(num1Over3);</span>
<span class="fc" id="L85">        movieStats.add(num25Over3);</span>
<span class="fc" id="L86">        movieStats.add(num35Over3);</span>
<span class="fc" id="L87">        movieStats.add(num50Over3);</span>
<span class="fc" id="L88">        movieStats.add(sumOfRatings);</span>
<span class="fc" id="L89">        movieStats.add(numOfRatings);</span>

<span class="fc" id="L91">        return movieStats;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>